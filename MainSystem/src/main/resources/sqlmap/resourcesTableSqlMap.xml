<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xm.bibibiradio.mainsystem.dal.ResourceDAO">
    <!-- 增删查改的Statement配置 -->
    <!--
    <select id="getAllUsers" resultType="user"><![CDATA[
        SELECT id, name FROM user ORDER BY id
    ]]></select>
    -->
    
    <select id="selectMaxDataByType" resultType="ResourceData" parameterType="String"><![CDATA[
        select r_id as rId,r_type as rType,r_source as rSource,r_category as rCategory,author,r_duration as rDuration,r_pv as rPv,r_comment as rComment,r_danmu as rDanmu,r_collect as rCollect,r_tags as rTags,r_coin as rCoin,is_valid as isValid,other_detail as otherDetail,r_gmt_create as rGmtCreate,item_gmt_insert as itemGmtInsert,r_url as rUrl,r_show_url as rShowUrl,r_title as rTitle,r_score as rScore
        from resources 
        where 
        r_gmt_create = (select max(r_gmt_create) 
        from resources 
        where r_type = #{rType});
    ]]></select>
    
    <select id="selectDateTypeFirst" resultType="ResourceData" parameterType="Map"><![CDATA[
        select r_id as rId,r_type as rType,r_source as rSource,r_category as rCategory,author,r_duration as rDuration,r_pv as rPv,r_comment as rComment,r_danmu as rDanmu,r_collect as rCollect,r_tags as rTags,r_coin as rCoin,is_valid as isValid,other_detail as otherDetail,r_gmt_create as rGmtCreate,item_gmt_insert as itemGmtInsert,r_url as rUrl,r_show_url as rShowUrl,r_title as rTitle,r_score as rScore
        from resources 
        where 
        r_gmt_create >= #{startDate} and r_gmt_create <= #{endDate} and r_type = #{rType}
        order by r_id asc
        limit 1
    ]]>
    </select>
    
    <select id="selectDateTypeEnd" resultType="ResourceData" parameterType="Map"><![CDATA[
        select r_id as rId,r_type as rType,r_source as rSource,r_category as rCategory,author,r_duration as rDuration,r_pv as rPv,r_comment as rComment,r_danmu as rDanmu,r_collect as rCollect,r_tags as rTags,r_coin as rCoin,is_valid as isValid,other_detail as otherDetail,r_gmt_create as rGmtCreate,item_gmt_insert as itemGmtInsert,r_url as rUrl,r_show_url as rShowUrl,r_title as rTitle,r_score as rScore
        from resources 
        where 
        r_gmt_create >= #{startDate} and r_gmt_create <= #{endDate} and r_type = #{rType}
        order by r_id desc
        limit 1
    ]]>
    </select>
    
    <insert id="insertResource" useGeneratedKeys="true" keyProperty="rId" parameterType="ResourceData"><![CDATA[
        INSERT INTO resources 
        (r_type,r_source,r_category,r_title,author,r_duration,r_pv,r_comment,r_danmu,r_collect,r_tags,r_coin,other_detail,r_url,r_show_url,r_gmt_create,item_gmt_insert,author_id) 
        VALUES 
        (#{rType},#{rSource},#{rCategory},#{rTitle},#{author},#{rDuration},#{rPv},#{rComment},#{rDanmu},#{rCollect},#{rTags},#{rCoin},#{otherDetail},#{rUrl},#{rShowUrl},#{rGmtCreate},now(),#{authorId});
    ]]></insert>
    
    <update id="updateResource" parameterType="ResourceData"><![CDATA[
        UPDATE resources SET r_pv=#{rPv},r_comment=#{rComment},r_danmu=#{rDanmu},r_collect=#{rCollect},r_tags=#{rTags},r_coin=#{rCoin},item_gmt_insert=now() WHERE r_id=#{rId}
    ]]></update>
    
    <delete id="deleteAll">  
        <![CDATA[ 
           delete from resources where 1=1 
        ]]>  
    </delete>
</mapper>